<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LOON Aptos Ecosystem Dashboard</title>
    <!-- Load Tailwind CSS and Inter Font -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        
        :root {
            --primary-color: #5b21b6; /* Purple */
            --secondary-color: #3b82f6; /* Blue */
            --background-color: #030712; /* Dark Gray */
            --card-background: #111827; /* Medium Dark Gray */
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--background-color);
            color: #e5e7eb;
            min-height: 100vh;
        }

        .card {
            background-color: var(--card-background);
            border: 1px solid rgba(55, 65, 81, 0.5);
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(91, 33, 182, 0.3), 0 4px 6px -2px rgba(91, 33, 182, 0.1);
        }

        .gradient-text {
            background-image: linear-gradient(to right, var(--secondary-color), var(--primary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Chart Container Styling */
        #chart-placeholder {
            height: 250px;
            background: linear-gradient(to top, #1f2937, #111827);
            position: relative;
        }

        /* Line Graph Draw Animation */
        @keyframes drawLine {
            from {
                stroke-dashoffset: 1000;
            }
            to {
                stroke-dashoffset: 0;
            }
        }

        .line-graph-path {
            stroke-dasharray: 1000;
            stroke-dashoffset: 1000;
            animation: drawLine 3s ease-in-out forwards;
        }
    </style>
</head>
<body>

    <div class="container mx-auto p-4 md:p-8">
        <!-- Header Section -->
        <header class="text-center mb-12">
            <h1 class="text-5xl md:text-7xl font-extrabold gradient-text">
                LOON
            </h1>
            <p class="text-xl md:text-2xl mt-2 text-gray-400">
                $LOON is the community token initiated from The Loonies, the official NFT collection of 
                <a href="https://x.com/wapal_official" target="_blank" class="text-blue-400 hover:underline">@wapal_official</a>
                on 
                <a href="https://aptos.dev/" target="_blank" class="text-green-400 hover:underline">@Aptos</a>
            </p>
        </header>

        <!-- Live Statistics (Stat Cards) -->
        <section class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
            
            <!-- Current Holder Count -->
            <div id="holders-card" class="card p-6 rounded-2xl">
                <p class="text-sm font-semibold text-gray-400 flex items-center mb-3">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 mr-2 text-blue-400">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M18 18.72a4.5 4.5 0 0 0 2.343-3.375M12 12.75a4.5 4.5 0 0 1 2.343-3.375M12 12.75A4.5 4.5 0 0 1 9.657 9.375M12 12.75v3.625M9.657 15.375h4.686M12 12.75v3.625m4.686 0H9.657m7.03-4.375c.348-.152.693-.298 1.037-.436.72-.284 1.254-.925 1.254-1.666V8.188c0-1.054-.91-1.634-1.859-1.25l-.176.071m-5.88 4.305a2.25 2.25 0 0 1-4.331 1.039m4.331-1.039v3.625m-4.331-3.625h4.331m0 0a2.25 2.25 0 0 0 2.343-3.375M12 15.375v3.375h2.25" />
                    </svg>
                    Current Holders
                </p>
                <div class="text-4xl font-bold text-white mb-1" id="current-holders">
                    Loading...
                </div>
                <p class="text-sm text-gray-500">On the Aptos Network</p>
            </div>

            <!-- Daily Change -->
            <div id="change-card" class="card p-6 rounded-2xl">
                <p class="text-sm font-semibold text-gray-400 flex items-center mb-3">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 mr-2 text-purple-400">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M7.5 14.25v2.25m4.5-4.5v4.5m4.5-6.75v6.75m0 0L17.25 10m-4.5 0L10.5 8m-4.5 0L3.75 6m12 12l2.25 2.25m-2.25-2.25L15 21" />
                    </svg>
                    Daily Holder Change
                </p>
                <!-- Holder Change Value -->
                <div class="text-4xl font-bold mb-1" id="daily-change-value">
                    Loading...
                </div>
                <!-- Percentage Change Description -->
                <p class="text-sm" id="daily-change-percent">Calculating...</p>
            </div>

            <!-- Contract Address -->
            <div class="card p-6 rounded-2xl flex flex-col justify-between">
                <div>
                    <p class="text-sm font-semibold text-gray-400 flex items-center mb-3">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 mr-2 text-green-400">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 10.5V6a2.25 2.25 0 0 0-2.25-2.25H6A2.25 2.25 0 0 0 3.75 6v7.5A2.25 2.25 0 0 0 6 15h4.5m-2.25 2.25H16.5A2.25 2.25 0 0 0 18.75 15V9.75A2.25 2.25 0 0 0 16.5 7.5h-4.5M10.5 7.5l-.234-.699a2.25 2.25 0 0 0-2.02-1.301H6" />
                        </svg>
                        Contract Address
                    </p>
                    <code class="text-xs break-all text-yellow-300 bg-gray-700 p-2 rounded-lg inline-block w-full">
                        0x268d4a7a2ad93274edf6116f9f20ad8455223a7ab5fc73154f687e7dbc3e3ec6::LOON::LOON
                    </code>
                </div>
                <button onclick="copyContractAddress()" class="mt-4 w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-xl transition duration-200 shadow-md hover:shadow-lg">
                    Copy Address
                </button>
            </div>
        </section>
        
        <!-- Holder Change Chart (Line Graph Simulation) -->
        <section class="mb-12">
            <div class="card p-6 rounded-2xl">
                <h2 class="text-xl font-bold mb-4 text-white">Holder Growth Chart (Last 7 Days)</h2>
                <div id="chart-placeholder" class="rounded-xl overflow-hidden relative p-4">
                    <!-- Simple Line Chart simulation using SVG -->
                    <svg width="100%" height="100%" viewBox="0 0 1000 220" preserveAspectRatio="none">
                        
                        <!-- Grid Lines (Horizontal) -->
                        <line x1="0" y1="20" x2="1000" y2="20" stroke="#374151" stroke-width="1" stroke-dasharray="5,5" />
                        <line x1="0" y1="70" x2="1000" y2="70" stroke="#374151" stroke-width="1" stroke-dasharray="5,5" />
                        <line x1="0" y1="120" x2="1000" y2="120" stroke="#374151" stroke-width="1" stroke-dasharray="5,5" />
                        <line x1="0" y1="170" x2="1000" y2="170" stroke="#374151" stroke-width="1" stroke-dasharray="5,5" />

                        <!-- Line Data Points (SVG Path 'd' attribute) -->
                        <!-- This path simulates an upward trend (Bottom Left -> Top Right) -->
                        <path 
                            class="line-graph-path"
                            d="M 0 170 
                               C 100 150, 200 180, 300 140
                               C 400 100, 500 130, 600 90
                               C 700 60, 800 80, 900 40
                               L 1000 20"
                            fill="none"
                            stroke="#3b82f6" /* Secondary Color (Blue) */
                            stroke-width="4"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                        />
                        
                        <!-- Area Under the Line (Gradient Area) -->
                        <defs>
                            <linearGradient id="areaGradient" x1="0" y1="0" x2="0" y2="1">
                                <stop offset="0%" stop-color="#3b82f6" stop-opacity="0.3"/>
                                <stop offset="100%" stop-color="#3b82f6" stop-opacity="0.0"/>
                            </linearGradient>
                        </defs>
                        <path 
                            class="line-graph-path"
                            d="M 0 170 
                               C 100 150, 200 180, 300 140
                               C 400 100, 500 130, 600 90
                               C 700 60, 800 80, 900 40
                               L 1000 20
                               L 1000 220 L 0 220 Z"
                            fill="url(#areaGradient)"
                            stroke="none"
                        />
                    </svg>

                    <!-- Labels (Days) -->
                    <div class="absolute bottom-0 left-0 right-0 flex justify-between text-xs text-gray-400 px-4 pb-1">
                        <span>Day -6</span>
                        <span>Day -5</span>
                        <span>Day -4</span>
                        <span>Day -3</span>
                        <span>Day -2</span>
                        <span>Day -1</span>
                        <span>Today</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- LLM Tools Section -->
        <section class="mb-12">
            <div class="card p-6 rounded-2xl">
                <h2 class="text-xl font-bold mb-4 text-white flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 mr-2 text-purple-400">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.455L14.25 6l1.035-.259a3.375 3.375 0 0 0 2.455-2.455L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.455 2.455L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.455 2.455Z" />
                    </svg>
                    Gemini LLM Tools (LOON Analysis)
                </h2>
                <p class="text-gray-400 mb-6">Use the power of Gemini to instantly generate summaries and social media headlines about LOON.</p>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <button id="summary-btn" onclick="generateSummary()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-xl transition duration-200 shadow-md hover:shadow-lg disabled:opacity-50">
                        Token Summary and Analysis ✨
                    </button>
                    <button id="headline-btn" onclick="generateHeadline()" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-xl transition duration-200 shadow-md hover:shadow-lg disabled:opacity-50">
                        Generate News Headline ✨
                    </button>
                </div>

                <!-- Result Area -->
                <div id="llm-result" class="mt-4 min-h-24 bg-gray-800/50 p-4 rounded-xl flex items-center justify-center text-gray-400 text-center">
                    Select the analysis or headline you wish to generate.
                </div>
            </div>
        </section>
        
        <!-- Token Info and Links -->
        <section class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-12">
            
            <!-- About LOON -->
            <div class="card p-6 rounded-2xl">
                <h2 class="text-xl font-bold mb-4 text-white">About LOON</h2>
                <ul class="space-y-3 text-gray-400">
                    <li class="flex justify-between items-center border-b border-gray-700 pb-2">
                        <span>Platform:</span>
                        <span class="font-semibold text-blue-400">Aptos</span>
                    </li>
                    <li class="flex justify-between items-center border-b border-gray-700 pb-2">
                        <span>Total Supply:</span>
                        <span class="font-semibold text-white">1,000,000,000,000 LOON</span>
                    </li>
                    <li class="flex justify-between items-center border-b border-gray-700 pb-2">
                        <span>Type:</span>
                        <span class="font-semibold text-white">Move Module Token</span>
                    </li>
                    <li class="flex justify-between items-center">
                        <span>LOON Price (Simulation):</span>
                        <span class="font-semibold text-green-400" id="token-price">$0.00000045</span>
                    </li>
                </ul>
            </div>

            <!-- Community Links -->
            <div class="card p-6 rounded-2xl">
                <h2 class="text-xl font-bold mb-4 text-white">Community & Resources</h2>
                <div class="flex flex-wrap gap-4">
                    <a href="https://x.com/theloonies_nft" class="flex items-center bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded-full transition duration-200">
                        <span class="text-2xl mr-2">🐦</span> Twitter
                    </a>
                    <a href="https://discord.gg/cKE7ghsS" class="flex items-center bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded-full transition duration-200">
                        <span class="text-2xl mr-2">💬</span> Discord
                    </a>
                    <a href="https://explorer.aptoslabs.com/coin/0x268d4a7a2ad93274edf6116f9f20ad8455223a7ab5fc73154f687e7dbc3e3ec6::LOON::LOON?network=mainnet" class="flex items-center bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded-full transition duration-200">
                        <span class="text-2xl mr-2">🔗</span> AptosScan
                    </a>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="text-center mt-10 p-4 border-t border-gray-800 text-gray-500 text-sm">
            <p>&copy; 2024 LOON Aptos. All rights reserved. Data is for simulation purposes only.</p>
        </footer>

    </div>

    <script>
        // DOM elements
        const currentHoldersEl = document.getElementById('current-holders');
        const dailyChangeValueEl = document.getElementById('daily-change-value');
        const dailyChangePercentEl = document.getElementById('daily-change-percent');
        const tokenPriceEl = document.getElementById('token-price');
        
        // Global variables for Gemini API
        const apiKey = ""; // Canvas runtime provides this if left empty
        const geminiFlashUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

        // Global state to store the latest fetched stats for LLM use
        let currentStats = null;
        
        // Simulated Contract Address
        const contractAddress = "0x268d4a7a2ad93274edf6116f9f20ad8455223a7ab5fc73154f687e7dbc3e3ec6::LOON::LOON";

        /**
         * Handles API fetch with exponential backoff for retries.
         */
        async function fetchWithRetry(url, options, retries = 5) {
            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (!response.ok) {
                        // If it's a 429 (Rate Limit), try again
                        if (response.status === 429 && i < retries - 1) {
                            const delay = Math.pow(2, i) * 1000 + Math.floor(Math.random() * 1000);
                            console.warn(`Rate limit hit, retrying in ${delay}ms...`);
                            await new Promise(resolve => setTimeout(resolve, delay));
                            continue; 
                        }
                        // For other errors, throw
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }
                    return response;
                } catch (error) {
                    if (i < retries - 1) {
                        const delay = Math.pow(2, i) * 1000 + Math.floor(Math.random() * 1000);
                        console.warn(`Fetch error (${error.message}), retrying in ${delay}ms...`);
                        await new Promise(resolve => setTimeout(resolve, delay));
                    } else {
                        throw new Error(`Failed to fetch after ${retries} attempts: ${error.message}`);
                    }
                }
            }
        }

        /**
         * Simulates fetching data from a real Aptos indexer/API.
         */
        async function fetchLoonStats() {
            // Mock data from API
            const mockStats = {
                currentHolders: 14523,
                dailyHolderChange: 157, // positive = increase. Change this to a negative number to test the 'decrease' logic.
                dailyHolderChangePercent: 1.09,
                priceUSD: 0.00000045,
                marketCapUSD: 6500000, 
            };

            // Simulate a network delay
            await new Promise(resolve => setTimeout(resolve, 1000));

            // Set global stats
            currentStats = mockStats;
            return mockStats;
        }

        /**
         * Formats a number with thousands separators.
         */
        function formatNumber(num) {
            // Using 'en-US' locale for standard English number formatting (commas)
            return new Intl.NumberFormat('en-US').format(Math.abs(num));
        }

        /**
         * Renders the data to the UI.
         */
        async function updateUI() {
            try {
                const stats = await fetchLoonStats();
                
                // Current Holders Count
                currentHoldersEl.textContent = formatNumber(stats.currentHolders);

                // Daily Change Value and Color
                const changeValue = formatNumber(stats.dailyHolderChange);
                const isPositive = stats.dailyHolderChange >= 0;
                
                // Display the change value (with sign)
                dailyChangeValueEl.textContent = `${isPositive ? '+' : '-'}${changeValue}`;

                // Remove previous styling
                dailyChangeValueEl.classList.remove('text-green-400', 'text-red-400', 'text-white');
                dailyChangePercentEl.classList.remove('text-green-400', 'text-red-400');
                
                // Apply new styling and English descriptive text
                if (stats.dailyHolderChange > 0) {
                    dailyChangeValueEl.classList.add('text-green-400');
                    dailyChangePercentEl.classList.add('text-green-400');
                    dailyChangePercentEl.textContent = `(${stats.dailyHolderChangePercent.toFixed(2)}%) Percentage increase`;
                } else if (stats.dailyHolderChange < 0) {
                    dailyChangeValueEl.classList.add('text-red-400');
                    dailyChangePercentEl.classList.add('text-red-400');
                    dailyChangePercentEl.textContent = `(${stats.dailyHolderChangePercent.toFixed(2)}%) Percentage decrease`;
                } else {
                    // Change is zero
                    dailyChangeValueEl.classList.add('text-white');
                    dailyChangePercentEl.textContent = 'No percentage change';
                }
                
                // Price
                tokenPriceEl.textContent = `$${stats.priceUSD}`;

            } catch (error) {
                console.error("Error loading statistics:", error);
                currentHoldersEl.textContent = "Error";
                dailyChangeValueEl.textContent = "Error";
                dailyChangePercentEl.textContent = "Data failed to load";
            }
        }

        /**
         * Generates a summary and analysis using Gemini and Google Search.
         */
        async function generateSummary() {
            const resultEl = document.getElementById('llm-result');
            const summaryButton = document.getElementById('summary-btn');

            if (!currentStats) {
                alertBox('Wait for the statistics to load first.', 'error');
                return;
            }

            // --- LLM Call Start ---
            summaryButton.disabled = true;
            summaryButton.innerHTML = '<span class="animate-spin mr-2">🌀</span> Analyzing...';
            resultEl.innerHTML = '<p class="text-gray-500 text-center py-4">Gemini API is running, please wait...</p>';
            
            const userQuery = `Based on the latest up-to-date information, and using the following simulation data, write a professional and concise single-paragraph summary and analysis about the $LOON token on Aptos to inform investors. 
                - Current Holder Count: ${formatNumber(currentStats.currentHolders)}
                - Daily Holder Change: ${currentStats.dailyHolderChange > 0 ? '+' : ''}${formatNumber(currentStats.dailyHolderChange)} (${currentStats.dailyHolderChangePercent.toFixed(2)}%)
                - Simulation Price: $${currentStats.priceUSD}
                - Simulation Market Cap: $${formatNumber(currentStats.marketCapUSD)}
                - Language: English.
            `;
            
            const systemPrompt = "You are a world-renowned financial analyst specializing in cryptocurrencies. Your task is to combine the provided data with real-time search results to deliver a brief, professional, single-paragraph summary and analysis for crypto investors.";
            
            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                tools: [{ "google_search": {} }],
                systemInstruction: {
                    parts: [{ text: systemPrompt }]
                },
            };

            const options = {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            };

            try {
                const response = await fetchWithRetry(geminiFlashUrl, options);
                const result = await response.json();
                
                const candidate = result.candidates?.[0];

                if (candidate && candidate.content?.parts?.[0]?.text) {
                    const text = candidate.content.parts[0].text;
                    let sourcesHtml = '';
                    
                    // Extract grounding sources (citations)
                    const groundingMetadata = candidate.groundingMetadata;
                    if (groundingMetadata && groundingMetadata.groundingAttributions) {
                        const sources = groundingMetadata.groundingAttributions
                            .map(attr => ({ uri: attr.web?.uri, title: attr.web?.title }))
                            .filter(source => source.uri && source.title)
                            .slice(0, 3); // Limit to top 3 sources

                        if (sources.length > 0) {
                            sourcesHtml = '<div class="mt-4 text-xs text-gray-400 border-t border-gray-700 pt-3">';
                            sourcesHtml += '<p class="font-semibold mb-1">Sources:</p><ul>';
                            sources.forEach((source, index) => {
                                sourcesHtml += `<li>${index + 1}. <a href="${source.uri}" target="_blank" class="text-blue-400 hover:underline">${source.title}</a></li>`;
                            });
                            sourcesHtml += '</ul></div>';
                        }
                    }

                    resultEl.innerHTML = `<div class="p-4 bg-gray-700/50 rounded-xl">${text}</div>${sourcesHtml}`;
                } else {
                    throw new Error("Could not receive a valid response from Gemini.");
                }

            } catch (error) {
                console.error("Gemini API Error:", error);
                resultEl.innerHTML = `<p class="text-red-400 text-center py-4">Error: Analysis could not be generated. (Error: ${error.message})</p>`;
            } finally {
                summaryButton.disabled = false;
                summaryButton.innerHTML = 'Token Summary and Analysis ✨';
            }
            // --- LLM Call End ---
        }

        /**
         * Generates a catchy social media headline based on holder change.
         */
        async function generateHeadline() {
            const resultEl = document.getElementById('llm-result');
            const headlineButton = document.getElementById('headline-btn');
            
            if (!currentStats) {
                alertBox('Wait for the statistics to load first.', 'error');
                return;
            }

            // --- LLM Call Start ---
            headlineButton.disabled = true;
            headlineButton.innerHTML = '<span class="animate-spin mr-2">🌀</span> Generating...';
            resultEl.innerHTML = '<p class="text-gray-500 text-center py-4">Gemini API is running, please wait...</p>';

            const isPositive = currentStats.dailyHolderChange >= 0;
            const changeType = isPositive ? 'increase' : 'decrease';
            const sign = isPositive ? '+' : '';
            const changeValue = formatNumber(Math.abs(currentStats.dailyHolderChange));
            
            const userQuery = `The $LOON token on Aptos has seen a noticeable holder ${changeType} of ${sign}${changeValue} (${currentStats.dailyHolderChangePercent.toFixed(2)}%) in the last 24 hours. Use this data to create a single-sentence, short, and enthusiastic (if positive change) or thought-provoking (if negative change) news headline for Twitter (X) that includes hashtags and emojis to immediately capture the attention of the crypto community. The output should contain only the headline. Language: English.`;
            
            const systemPrompt = "You are a creative expert in social media content creation for cryptocurrencies and the Aptos ecosystem. Generate an enthusiastic and engagement-focused Twitter headline based on the provided data.";
            
            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                // No grounding needed, purely creative based on prompt
                systemInstruction: {
                    parts: [{ text: systemPrompt }]
                },
            };

            const options = {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            };

            try {
                const response = await fetchWithRetry(geminiFlashUrl, options);
                const result = await response.json();
                const text = result.candidates?.[0]?.content?.parts?.[0]?.text || "Headline could not be generated.";
                
                resultEl.innerHTML = `<div class="p-4 bg-gray-700/50 rounded-xl"><p class="text-lg text-yellow-300 font-mono break-words">${text}</p></div>`;

            } catch (error) {
                console.error("Gemini API Error:", error);
                resultEl.innerHTML = `<p class="text-red-400 text-center py-4">Error: Headline could not be generated. (Error: ${error.message})</p>`;
            } finally {
                headlineButton.disabled = false;
                headlineButton.innerHTML = 'Generate News Headline ✨';
            }
            // --- LLM Call End ---
        }

        /**
         * Copies the contract address to the clipboard.
         */
        function copyContractAddress() {
            // document.execCommand('copy') is preferred for compatibility
            const tempInput = document.createElement('textarea');
            tempInput.value = contractAddress;
            document.body.appendChild(tempInput);
            tempInput.select();
            
            try {
                document.execCommand('copy');
                alertBox('Contract address copied to clipboard!', 'success');
            } catch (err) {
                alertBox('Copying failed.', 'error');
            }
            document.body.removeChild(tempInput);
        }

        /**
         * Custom alert box (replacing alert())
         */
        function alertBox(message, type = 'info') {
            const container = document.querySelector('.container');
            let box = document.getElementById('custom-alert-box');
            
            if (!box) {
                box = document.createElement('div');
                box.id = 'custom-alert-box';
                box.className = 'fixed top-4 right-4 p-4 rounded-xl shadow-2xl z-50 transition-all duration-300 transform translate-x-full opacity-0';
                container.appendChild(box);
            }

            let bgColor = 'bg-gray-700';
            let textColor = 'text-white';
            
            if (type === 'success') {
                bgColor = 'bg-green-600';
            } else if (type === 'error') {
                bgColor = 'bg-red-600';
            }

            box.className = `fixed top-4 right-4 p-4 rounded-xl shadow-2xl z-50 transition-all duration-300 ${bgColor} ${textColor}`;
            box.innerHTML = `<p class="font-semibold">${message}</p>`;

            // Show
            setTimeout(() => {
                box.classList.remove('translate-x-full', 'opacity-0');
                box.classList.add('translate-x-0', 'opacity-100');
            }, 10);

            // Hide
            setTimeout(() => {
                box.classList.remove('translate-x-0', 'opacity-100');
                box.classList.add('translate-x-full', 'opacity-0');
            }, 3000);
        }

        // Initialize the application
        window.onload = updateUI;
    </script>
</body>
</html>
